---
import BaseLayout from "./BaseLayout.astro";
import Button from "../components/Button.astro";
import ActionButton from "../components/ActionButton.astro";
import Tag from "../components/Tag.astro";
import Icon from "../components/Icon.astro";
import Window from "../components/Window.astro";
import { getAuthor } from "../data/authors";
import { formatDateLong } from "../utils/styles";
import { Image } from "astro:assets";

interface Props {
  frontmatter: {
    title: string;
    author: string;
    date: Date;
    description: string;
    image?: string;
    categories: string[];
    resource?: boolean;
    resource_audiences?: string[];
  };
  rawContent?: string;
}

const { frontmatter, rawContent = "" } = Astro.props;

const formattedDate = formatDateLong(frontmatter.date);

const wordCount = rawContent
  .split(/\s+/)
  .filter((word) => word.length > 0).length;
const readTime = Math.max(1, Math.ceil(wordCount / 200));

const authorData = await getAuthor(frontmatter.author);
---

<BaseLayout
  title={`${frontmatter.title}`}
  description={frontmatter.description}
  image={frontmatter.image}
>
  <div class="post-layout">
    <Window
      title={`${frontmatter.title.substring(0, 30)}${frontmatter.title.length > 30 ? "..." : ""}.md`}
      class="post-content"
    >
      <div class="post-body">
        <header class="post-header">
          <div class="header-line cmd-line">
            <span class="comment">---</span>
          </div>
          <div class="meta-block">
            <div class="meta-line">
              <span class="key">title:</span>
              <span class="string">"{frontmatter.title}"</span>
            </div>
            <div class="meta-line">
              <span class="key">author:</span>
              <a href={`/authors/${frontmatter.author}`} class="author-link"
                >"{authorData?.name || frontmatter.author}"</a
              >
            </div>
            <div class="meta-line">
              <span class="key">read_time:</span>
              <span class="value">{readTime} dəq</span>
            </div>
            <div class="meta-line">
              <span class="key">date:</span>
              <span class="value">{formattedDate}</span>
            </div>
            <div class="meta-line">
              <span class="key">categories:</span>
              <span class="array"
                >[
                {
                  frontmatter.categories.map((cat, i) => (
                    <>
                      <Tag
                        name={cat}
                        href={`/blogs?cat=${encodeURIComponent(cat)}`}
                      />
                      {i < frontmatter.categories.length - 1 && (
                        <span class="comma">, </span>
                      )}
                    </>
                  ))
                }
                ]</span
              >
            </div>
            {
              frontmatter.resource && (
                <div class="meta-line">
                  <span class="key">tip:</span>
                  <Tag name="resurs" color="cyan" href="/resources" />
                </div>
              )
            }
            {
              frontmatter.resource_audiences &&
                frontmatter.resource_audiences.length > 0 && (
                  <div class="meta-line">
                    <span class="key">auditoriya:</span>
                    <span class="array">
                      [
                      {frontmatter.resource_audiences.map((audience, i) => (
                        <>
                          <Tag
                            name={audience}
                            color="orange"
                            href={`/resources?aud=${encodeURIComponent(audience)}`}
                          />
                          {i < frontmatter.resource_audiences!.length - 1 && (
                            <span class="comma">, </span>
                          )}
                        </>
                      ))}
                      ]
                    </span>
                  </div>
                )
            }
          </div>
          <div class="header-line cmd-line">
            <span class="comment">---</span>
          </div>
        </header>

        <div class="print-only-url">
          <strong>Mənbə:</strong>
          {Astro.url.href}
        </div>

        <h1 class="post-title">{frontmatter.title}</h1>

        <div class="prose">
          <slot />
        </div>

        <div class="comments-section">
          <h2 class="comments-title">
            <span class="comment">// </span>şərhlər
          </h2>
          <div id="giscus-container"></div>
        </div>

        <footer class="post-footer">
          <div class="footer-left">
            <Button
              href="/blogs"
              variant="primary"
              icon="arrowLeft"
              iconSize={14}
            >
              məqalələr.list()
            </Button>
          </div>
          <div class="footer-right">
            <ActionButton icon="printer" id="print-btn" title="Print" />
            <ActionButton icon="share" id="share-btn" title="Share" />
          </div>
        </footer>
      </div>
    </Window>

    <aside class="post-sidebar">
      <div class="sidebar-card">
        <h3><span class="comment">// </span>mündəricat</h3>
        <nav class="toc" id="toc">
          <!-- ToC will be generated by JS -->
        </nav>
      </div>

      <a
        href={`/authors/${frontmatter.author}`}
        class="sidebar-card author-card"
      >
        <div class="author-avatar">
          {
            authorData?.avatar ? (
              typeof authorData.avatar === "string" ? (
                <img src={authorData.avatar} alt={authorData.name} />
              ) : (
                <Image
                  src={authorData.avatar}
                  alt={authorData.name}
                  width={200}
                  height={200}
                  quality={100}
                />
              )
            ) : (
              <Icon name="user" size={20} />
            )
          }
        </div>
        <div class="author-info">
          <span class="author-label">// müəllif</span>
          <span class="author-name"
            >{authorData?.name || frontmatter.author}</span
          >
        </div>
      </a>
    </aside>
  </div>
</BaseLayout>

<script>
  document.addEventListener("DOMContentLoaded", () => {
    const prose = document.querySelector(".prose");
    const toc = document.getElementById("toc");

    // Process footnotes
    if (prose) {
      processFootnotes(prose);
    }

    if (prose && toc) {
      const headings = prose.querySelectorAll("h2, h3");

      if (headings.length === 0) {
        toc.innerHTML = '<span class="no-toc">// başlıq yoxdur</span>';
        return;
      }

      headings.forEach((heading, index) => {
        const id = `heading-${index}`;
        heading.id = id;

        const link = document.createElement("a");
        link.href = `#${id}`;
        link.textContent = heading.textContent;
        link.className = `toc-link ${heading.tagName.toLowerCase() === "h3" ? "indent" : ""}`;

        toc.appendChild(link);
      });
    }

    function processFootnotes(container) {
      const footnoteRegex = /\[\^([^\]]+)\]/g;
      const walker = document.createTreeWalker(
        container,
        NodeFilter.SHOW_TEXT,
        null,
      );

      const nodesToProcess = [];
      let node;
      while ((node = walker.nextNode())) {
        if (footnoteRegex.test(node.textContent)) {
          nodesToProcess.push(node);
        }
        footnoteRegex.lastIndex = 0;
      }

      nodesToProcess.forEach((textNode) => {
        const parent = textNode.parentNode;
        const text = textNode.textContent;
        const fragment = document.createDocumentFragment();
        let lastIndex = 0;
        let match;

        footnoteRegex.lastIndex = 0;
        while ((match = footnoteRegex.exec(text)) !== null) {
          // Add text before the footnote
          if (match.index > lastIndex) {
            fragment.appendChild(
              document.createTextNode(text.slice(lastIndex, match.index)),
            );
          }

          // Create footnote element
          const footnote = createFootnote(match[1]);
          fragment.appendChild(footnote);

          lastIndex = match.index + match[0].length;
        }

        // Add remaining text
        if (lastIndex < text.length) {
          fragment.appendChild(document.createTextNode(text.slice(lastIndex)));
        }

        parent.replaceChild(fragment, textNode);
      });
    }

    function createFootnote(content) {
      const container = document.createElement("span");
      container.className = "footnote-container";

      const trigger = document.createElement("sup");
      trigger.className = "footnote-trigger";
      trigger.textContent = "[*]";

      const expansion = document.createElement("span");
      expansion.className = "footnote-expansion";
      expansion.textContent = content;

      container.appendChild(trigger);
      container.appendChild(expansion);

      trigger.addEventListener("click", (e) => {
        e.preventDefault();
        container.classList.toggle("active");

        // Close other open footnotes
        document
          .querySelectorAll(".footnote-container.active")
          .forEach((fn) => {
            if (fn !== container) {
              fn.classList.remove("active");
            }
          });
      });

      return container;
    }

    // Close footnotes when clicking outside
    document.addEventListener("click", (e) => {
      if (!e.target.closest(".footnote-container")) {
        document
          .querySelectorAll(".footnote-container.active")
          .forEach((fn) => {
            fn.classList.remove("active");
          });
      }
    });

    // Share Button: Native share or copy link
    const shareBtn = document.getElementById("share-btn");
    if (shareBtn) {
      shareBtn.addEventListener("click", async () => {
        const url = window.location.href;
        const title = document.title;

        try {
          // Try native share first
          if (navigator.share) {
            await navigator.share({
              title: title,
              url: url,
            });
          } else {
            // Fallback to copy link
            await navigator.clipboard.writeText(url);

            // Change icon to checkmark with green color
            const icon = shareBtn.querySelector("svg");
            if (icon) {
              const originalHTML = icon.innerHTML;
              icon.innerHTML =
                '<path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 13l4 4L19 7"/>';
              shareBtn.classList.add("shared");

              // Revert after 2 seconds
              setTimeout(() => {
                icon.innerHTML = originalHTML;
                shareBtn.classList.remove("shared");
              }, 2000);
            }
          }
        } catch (err) {
          // User cancelled or error occurred
          console.error("Share error:", err);
        }
      });
    }

    // Print mode: Create footnotes section at bottom
    function setupPrintFootnotes() {
      const footnotes = document.querySelectorAll(".footnote-container");

      if (footnotes.length === 0) return;

      // Remove existing print footnotes section if any
      const existingSection = document.getElementById("print-footnotes");
      if (existingSection) {
        existingSection.remove();
      }

      // Create footnotes section
      const footnotesSection = document.createElement("div");
      footnotesSection.id = "print-footnotes";
      footnotesSection.className = "print-footnotes-section";

      const heading = document.createElement("h2");
      heading.textContent = "Qeydlər";
      footnotesSection.appendChild(heading);

      const list = document.createElement("ol");

      footnotes.forEach((container, index) => {
        const number = index + 1;
        const expansion = container.querySelector(".footnote-expansion");
        const trigger = container.querySelector(".footnote-trigger");

        if (expansion && trigger) {
          // Update trigger to show number
          trigger.setAttribute("data-footnote-num", number);

          // Add footnote to list
          const li = document.createElement("li");
          li.textContent = expansion.textContent;
          list.appendChild(li);
        }
      });

      footnotesSection.appendChild(list);

      // Add to end of prose content
      if (prose) {
        prose.appendChild(footnotesSection);
      }
    }

    // Setup print footnotes on load and before print
    setupPrintFootnotes();
    window.addEventListener("beforeprint", setupPrintFootnotes);

    // Move author card after print-only-url in print mode
    let originalAuthorParent = null;
    let originalAuthorNextSibling = null;

    window.addEventListener("beforeprint", () => {
      const authorCard = document.querySelector(".author-card");
      const printUrl = document.querySelector(".print-only-url");

      if (authorCard && printUrl && !authorCard.hasAttribute("data-moved")) {
        // Store original position
        originalAuthorParent = authorCard.parentNode;
        originalAuthorNextSibling = authorCard.nextSibling;

        authorCard.setAttribute("data-moved", "true");
        printUrl.parentNode.insertBefore(authorCard, printUrl.nextSibling);
      }
    });

    window.addEventListener("afterprint", () => {
      const authorCard = document.querySelector(".author-card");

      if (authorCard && authorCard.hasAttribute("data-moved")) {
        // Move back to original position
        authorCard.removeAttribute("data-moved");
        if (originalAuthorParent) {
          if (originalAuthorNextSibling) {
            originalAuthorParent.insertBefore(
              authorCard,
              originalAuthorNextSibling,
            );
          } else {
            originalAuthorParent.appendChild(authorCard);
          }
        }
      }
    });

    // Print Button
    const printBtn = document.getElementById("print-btn");
    if (printBtn) {
      printBtn.addEventListener("click", () => {
        window.print();
      });
    }
  });
</script>

<script>
  // Load giscus comments
  const script = document.createElement("script");
  script.src = "https://giscus.app/client.js";
  script.setAttribute("data-repo", "BarishNamazov/kodlar.az");
  script.setAttribute("data-repo-id", "R_kgDOREVWjw");
  script.setAttribute("data-category", "Məqalələr");
  script.setAttribute("data-category-id", "DIC_kwDOREVWj84C1u8q");
  script.setAttribute("data-mapping", "pathname");
  script.setAttribute("data-strict", "0");
  script.setAttribute("data-reactions-enabled", "1");
  script.setAttribute("data-emit-metadata", "0");
  script.setAttribute("data-input-position", "bottom");
  script.setAttribute("data-theme", "catppuccin_latte");
  script.setAttribute("data-lang", "en");
  script.setAttribute("crossorigin", "anonymous");
  script.async = true;

  const container = document.getElementById("giscus-container");
  if (container) {
    container.appendChild(script);
  }
</script>

<style>
  .post-layout {
    max-width: 1120px;
    margin: 0 auto;
    padding: 2rem 1.5rem;
    display: grid;
    grid-template-columns: 1fr 280px;
    gap: 1.5rem;
  }

  .post-body {
    padding: 1.5rem;
  }

  /* Header */
  .post-header {
    margin-bottom: 2rem;
    font-family: var(--font-mono);
    font-size: 0.8125rem;
  }

  .print-only-url {
    display: none;
  }

  .post-title {
    font-size: 2rem;
    font-weight: 700;
    margin: 0 0 2rem;
    color: var(--color-text);
    line-height: 1.3;
  }

  .post-title::before {
    content: "# ";
    color: var(--color-text-muted);
    font-family: var(--font-mono);
  }

  .meta-block {
    padding: 0.75rem 0;
  }

  .meta-line {
    display: flex;
    gap: 0.5rem;
    padding: 0.25rem 0;
    flex-wrap: wrap;
    align-items: center;
  }

  .key {
    color: var(--color-purple);
  }
  .value {
    color: var(--color-cyan);
  }
  .array {
    color: var(--color-text-secondary);
  }
  .comma {
    color: var(--color-text-muted);
  }

  .author-link {
    color: var(--color-green);
    text-decoration: none;
    transition: all var(--transition-fast);
  }

  .author-link:hover {
    color: var(--color-primary);
    text-decoration: underline;
  }

  /* Prose Content */
  .prose {
    line-height: 1.8;
    color: var(--color-text);
  }

  .prose :global(h2) {
    font-size: 1.375rem;
    font-weight: 600;
    margin: 1.5rem 0 1rem;
    color: var(--color-text);
  }

  .prose :global(h2::before) {
    content: "## ";
    color: var(--color-text-muted);
    font-family: var(--font-mono);
  }

  .prose :global(h3) {
    font-size: 1.125rem;
    font-weight: 600;
    margin: 1.5rem 0 0.75rem;
    color: var(--color-text);
  }

  .prose :global(h3::before) {
    content: "### ";
    color: var(--color-text-muted);
    font-family: var(--font-mono);
  }

  .prose :global(p) {
    margin-bottom: 1.25rem;
    color: var(--color-text-secondary);
  }

  .prose :global(ul),
  .prose :global(ol) {
    margin-bottom: 1.25rem;
    padding-left: 1.5rem;
    color: var(--color-text-secondary);
  }

  .prose :global(li) {
    margin-bottom: 0.5rem;
  }

  .prose :global(a) {
    color: var(--color-primary);
    text-decoration: underline;
    text-underline-offset: 2px;
  }

  .prose :global(a:hover) {
    color: var(--color-primary-hover);
  }

  .prose :global(strong) {
    color: var(--color-text);
    font-weight: 600;
  }

  .prose :global(hr) {
    border: none;
    margin: 2rem 0;
    overflow: visible;
    text-align: center;
    height: auto;
    line-height: 1;
  }

  .prose :global(hr::before) {
    content: "/* ──────────────────────────────── */";
    display: block;
    font-family: var(--font-mono);
    font-size: 0.8125rem;
    color: var(--color-text-muted);
    letter-spacing: 0.05em;
  }

  .prose :global(blockquote) {
    margin: 1.5rem 0;
    padding: 1rem 1.25rem;
    background: var(--color-surface);
    border-left: 3px solid var(--color-primary);
    border-radius: 0 var(--radius-md) var(--radius-md) 0;
    color: var(--color-text-secondary);
    font-style: italic;

    p {
      margin-bottom: 0;
    }
  }

  .prose :global(pre) {
    margin: 1.5rem 0;
    padding: 1rem;
    background: var(--color-bg-secondary);
    border: 1px solid var(--color-border);
    border-radius: var(--radius-lg);
    overflow-x: auto;
    font-family: var(--font-mono);
    font-size: 0.8125rem;
    line-height: 1.7;
  }

  .prose :global(code) {
    font-family: var(--font-mono);
  }

  .prose :global(:not(pre) > code) {
    background: var(--color-surface);
    color: var(--color-cyan);
    padding: 0.125rem 0.375rem;
    border-radius: var(--radius-sm);
    font-size: 0.875em;
  }

  .prose :global(img) {
    max-width: 100%;
    height: auto;
    border-radius: var(--radius-lg);
    margin: 1.5rem 0;
    border: 1px solid var(--color-border);
  }

  /* Footnotes */
  .prose :global(.footnote-container) {
    display: inline;
  }

  .prose :global(.footnote-trigger) {
    color: var(--color-primary);
    cursor: pointer;
    font-size: 0.75em;
    font-weight: 600;
    margin: 0 0.125rem;
    transition: color var(--transition-fast);
  }

  .prose :global(.footnote-trigger:hover) {
    color: var(--color-primary-hover);
  }

  .prose :global(.footnote-expansion) {
    display: none;
  }

  .prose :global(.footnote-container.active .footnote-expansion) {
    display: inline;
    color: var(--color-text-muted);
    font-style: italic;
    padding: 0 0.25rem;
    background: var(--color-surface);
    border-radius: var(--radius-sm);
    animation: footnoteExpand 0.2s ease;
  }

  @keyframes footnoteExpand {
    from {
      opacity: 0;
    }
    to {
      opacity: 1;
    }
  }

  .prose :global(.footnote-container.active .footnote-expansion::before) {
    content: " (";
    color: var(--color-text-muted);
  }

  .prose :global(.footnote-container.active .footnote-expansion::after) {
    content: ") ";
    color: var(--color-text-muted);
  }

  /* Comments Section */
  .comments-section {
    margin-top: 3rem;
    padding-top: 2rem;
    border-top: 1px solid var(--color-border);
  }

  .comments-title {
    font-family: var(--font-mono);
    font-size: 1.125rem;
    font-weight: 600;
    margin: 0 0 1.5rem;
    color: var(--color-text);
  }

  .comments-title .comment {
    color: var(--color-text-muted);
  }

  #giscus-container :global(.giscus),
  #giscus-container :global(.giscus-frame) {
    outline: none !important;
    border: none !important;
  }

  #giscus-container :global(.giscus:focus),
  #giscus-container :global(.giscus-frame:focus) {
    outline: none !important;
    border: none !important;
  }

  /* Post Footer */
  .post-footer {
    display: flex;
    align-items: center;
    justify-content: space-between;
    margin-top: 2rem;
    padding-top: 1.5rem;
    border-top: 1px solid var(--color-border);
  }

  .footer-right {
    display: flex;
    gap: 0.5rem;
  }

  .action-btn.shared {
    color: var(--color-green);
  }

  /* Sidebar */
  .post-sidebar {
    display: flex;
    flex-direction: column;
    gap: 1rem;
    position: sticky;
    top: 5rem;
    height: fit-content;
  }

  /* ToC */
  .toc {
    display: flex;
    flex-direction: column;
    gap: 0.25rem;
    max-height: calc(100vh - 16rem);
    overflow-y: auto;
  }

  .toc :global(.toc-link) {
    display: block;
    padding: 0.375rem 0.5rem;
    font-family: var(--font-mono);
    font-size: 0.6875rem;
    color: var(--color-text-secondary);
    text-decoration: none;
    border-radius: var(--radius-sm);
    transition: all var(--transition-fast);
  }

  .toc :global(.toc-link:hover) {
    background: var(--color-bg-secondary);
    color: var(--color-primary);
  }

  .toc :global(.toc-link.indent) {
    padding-left: 1rem;
    color: var(--color-text-muted);
    font-size: 0.625rem;
  }

  .toc :global(.no-toc) {
    font-family: var(--font-mono);
    font-size: 0.625rem;
    color: var(--color-text-muted);
    font-style: italic;
  }

  /* Author Card */
  a.author-card {
    display: flex;
    align-items: center;
    gap: 0.75rem;
    text-decoration: none;
    transition: all var(--transition-fast);
  }

  a.author-card:hover {
    border-color: var(--color-green);
  }

  a.author-card:hover .author-name {
    color: var(--color-primary);
  }

  .author-avatar {
    width: 40px;
    height: 40px;
    display: flex;
    align-items: center;
    justify-content: center;
    background: var(--color-primary-muted);
    color: var(--color-primary);
    border-radius: var(--radius-md);
    overflow: hidden;
  }

  .author-avatar img {
    width: 100%;
    height: 100%;
    object-fit: cover;
  }

  .author-info {
    display: flex;
    flex-direction: column;
    gap: 0.125rem;
  }

  .author-label {
    font-family: var(--font-mono);
    font-size: 0.5625rem;
    color: var(--color-text-muted);
  }

  .author-name {
    font-family: var(--font-mono);
    font-size: 0.8125rem;
    font-weight: 600;
    color: var(--color-green);
    transition: color var(--transition-fast);
  }

  @media (max-width: 1024px) {
    .post-layout {
      grid-template-columns: 1fr;
    }

    .post-sidebar {
      position: static;
      flex-direction: row;
      flex-wrap: wrap;
    }

    .sidebar-card {
      flex: 1;
      min-width: 180px;
    }
  }

  @media (max-width: 768px) {
    .post-sidebar {
      order: -1;
      flex-direction: column;
    }

    .post-body {
      padding: 1rem;
    }

    .post-title {
      font-size: 1.5rem;
    }

    .prose :global(h2) {
      font-size: 1.25rem;
    }

    .prose :global(pre) {
      font-size: 0.75rem;
    }

    .prose :global(.footnote-container.active .footnote-expansion) {
      font-size: 0.875rem;
    }
  }

  /* Print styles */
  @media print {
    /* A4 page setup */
    @page {
      size: A4;
      margin: 2cm;
    }

    /* Hide navigation and footer */
    :global(header),
    :global(footer),
    :global(nav) {
      display: none !important;
    }

    :global(body) {
      margin: 0;
      padding: 0;
      background: white;
    }

    :global(main) {
      margin: 0 !important;
      padding: 0 !important;
      min-height: auto !important;
    }

    :global(*) {
      box-shadow: none !important;
    }

    .post-layout {
      display: block;
      max-width: 100%;
      padding: 0 1rem;
      margin: 0;
    }

    .post-content {
      border: none !important;
      box-shadow: none !important;
      background: white !important;
    }

    .post-content :global(.window-header) {
      display: none;
    }

    .post-content :global(.window-body) {
      border: none !important;
    }

    .post-body {
      padding: 0;
      display: flex;
      flex-direction: column;
    }

    .print-only-url {
      order: 1;
    }

    .post-header {
      order: 3;
    }

    .post-title {
      order: 4;
    }

    .prose {
      order: 5;
    }

    /* Hide comments and footer buttons */
    .comments-section {
      display: none;
    }

    .post-footer {
      display: none;
    }

    /* Hide entire sidebar in print (author will be moved via JS) */
    .post-sidebar {
      display: none !important;
    }

    /* Author card - style when moved into content area */
    .post-body a.author-card {
      display: flex !important;
      border: none !important;
      box-shadow: none !important;
      background: transparent !important;
      padding: 0;
      margin: 1rem 0 1.5rem 0;
      pointer-events: none;
      order: 2;
    }

    .author-avatar {
      -webkit-print-color-adjust: exact;
      print-color-adjust: exact;
      border: none !important;
    }

    .author-avatar img {
      border: none !important;
    }

    /* ToC links */
    .toc :global(.toc-link) {
      color: #000;
      text-decoration: none;
    }

    /* Content styling for print */
    .print-only-url {
      display: block !important;
      margin-bottom: 1.5rem;
      padding-bottom: 0.75rem;
      border-bottom: 1px solid #ddd;
      font-size: 0.875rem;
      color: #666;
      word-break: break-all;
    }

    .print-only-url strong {
      color: #000;
      font-weight: 600;
    }

    .post-header {
      page-break-after: avoid;
      border: none !important;
    }

    .header-line {
      border: none !important;
    }

    .post-title {
      color: #000;
      page-break-after: avoid;
    }

    .meta-line {
      color: #333;
    }

    .key,
    .value,
    .author-link,
    .author-name {
      color: #000 !important;
    }

    /* Prose content */
    .prose {
      color: #000;
    }

    .prose :global(h2),
    .prose :global(h3) {
      color: #000;
      page-break-after: avoid;
    }

    .prose :global(p),
    .prose :global(li) {
      color: #000;
      orphans: 3;
      widows: 3;
    }

    .prose :global(a) {
      color: #000;
      text-decoration: underline;
    }

    .prose :global(pre) {
      page-break-inside: avoid;
      border: 1px solid #ddd !important;
      background: #f5f5f5 !important;
      -webkit-print-color-adjust: exact;
      print-color-adjust: exact;
    }

    .prose :global(code) {
      color: #000;
      background: transparent !important;
    }

    .prose :global(:not(pre) > code) {
      background: #f0f0f0 !important;
      -webkit-print-color-adjust: exact;
      print-color-adjust: exact;
    }

    .prose :global(blockquote) {
      page-break-inside: avoid;
      border-left: 3px solid #000 !important;
      background: #f5f5f5 !important;
      border-right: none !important;
      border-top: none !important;
      border-bottom: none !important;
      -webkit-print-color-adjust: exact;
      print-color-adjust: exact;
    }

    .prose :global(img) {
      page-break-inside: avoid;
      max-width: 100%;
      border: none !important;
    }

    /* Footnotes in print */
    .prose :global(.footnote-expansion) {
      display: none !important;
    }

    .prose :global(.footnote-trigger) {
      display: inline !important;
      color: #000;
      cursor: default;
      font-size: 0.75em;
      vertical-align: super;
      font-size: 0;
    }

    .prose :global(.footnote-trigger::before) {
      content: "[" attr(data-footnote-num) "]";
      font-size: 0.75rem;
      color: #000;
    }

    /* Print footnotes section at bottom */
    .prose :global(#print-footnotes) {
      display: block !important;
      margin-top: 3rem;
      padding-top: 2rem;
      border-top: 2px solid #000;
      page-break-before: auto;
    }

    .prose :global(#print-footnotes h2) {
      font-size: 1.125rem;
      margin-bottom: 1rem;
      color: #000;
    }

    .prose :global(#print-footnotes h2::before) {
      content: "";
    }

    .prose :global(#print-footnotes ol) {
      margin: 0;
      padding-left: 1.5rem;
      list-style: decimal;
    }

    .prose :global(#print-footnotes li) {
      margin-bottom: 0.75rem;
      color: #333;
      font-size: 0.875rem;
      line-height: 1.6;
    }
  }

  /* Hide print footnotes section on screen */
  :global(#print-footnotes) {
    display: none;
  }
</style>
